Project-specific development guidelines

Audience: experienced Python developers working on this repository.

1) Environment and build basics
- Supported Python versions: 3.12 and 3.13 only (see project.requires-python in pyproject.toml). Ensure your interpreter matches this range.
- Build backend: uv_build. This repository is optimized for the uv toolchain, and includes a uv.lock. You don’t need uv to run tests locally, but using uv simplifies dependency group handling.
- Source layout: src/ layout with py.typed included (PEP 561). Package name is option.

Recommended setup with uv
- Install uv (one-time):
  - pipx install uv  (preferred)
  - or: python -m pip install uv
- From the project root, create a venv and sync dev dependencies:
  - uv sync -g dev
    - This resolves and installs all dependency groups required for development (docs, lint, test) and the package in editable mode.
- Use uv run to execute tools inside the environment:
  - uv run pytest
  - uv run ruff check .
  - uv run mypy src tests

Alternative setup with virtualenv + pip
Because dependency-groups in pyproject.toml are not pip extras, pip cannot install them via extras like .[dev]. If you prefer pip, install the required tools explicitly:
- Create and activate a venv, then:
  - python -m pip install -e .
  - python -m pip install pytest pytest-cov xdoctest ruff pylint pylint-per-file-ignores mypy ty sphinx pydata-sphinx-theme sphinx-multiversion gitpython

2) Testing: configuration, running, and adding tests
Configuration
- All pytest configuration lives in pyproject.toml under [tool.pytest.ini_options]. Key points:
  - addopts:
    - --cov --cov-branch with reports to terminal and coverage.xml
    - --doctest-modules to run standard doctests in src/option
    - --xdoctest to enable xdoctest collection in docstrings
    - -vvv for verbose output
  - testpaths = ["src/option/", "tests/"]
    - This means:
      - Unit tests under tests/ are collected normally
      - Docstring tests in src/option are also collected and executed
- Coverage XML is written to coverage.xml at repository root (useful for CI/badges). HTML is not generated by default.

Running tests
- With uv:
  - uv run pytest
- With a plain venv:
  - python -m pytest
- Typical focused runs:
  - python -m pytest tests/test_result.py::test_unwrap_ok -q
  - python -m pytest -k unwrap --maxfail=1

Adding new tests
- Put unit tests into tests/ with standard pytest naming conventions (e.g., tests/test_my_feature.py).
- You may also add doctests to public APIs in src/option/*.py. They are automatically collected by pytest via --doctest-modules and --xdoctest.

Example minimal test (validated)
- We verified the test collection and execution flow locally by creating and running a temporary test similar to the snippet below:

  # File: tests/test_demo_temp.py
  def test_demo_temp():
      assert 2 + 2 == 4

- It executed successfully via: python -m pytest tests/test_demo_temp.py
- Per repository hygiene, remove such ad hoc demo files after verification.

3) Linting, formatting and type checking
- Ruff (style, imports, and many lint rules)
  - Configuration: [tool.ruff] with line-length = 80, docstring-code-format = true, Google docstring convention enforced via pydocstyle selection (D); see ignores in pyproject.
  - Run: uv run ruff check .  (add --fix to auto-fix)
- Pylint
  - Config: [tool.pylint] with good-names exemptions (e.g., Err, Ok, NONE, Some), per-file test ignores, and plugin pylint_per_file_ignores.
  - Run: uv run pylint src tests
- Mypy (strict)
  - Config: [tool.mypy] strict = true. The project targets precise typing and public typing via py.typed.
  - Run: uv run mypy src tests
- Ty (optional runtime type checking)
  - Run: uv run ty src/option

Note: You can also use the entry-point script defined in pyproject [project.scripts]:
- dev-lint -> _dev.lint:lint_main (runs the configured lint/type checks)
- dev-test -> _dev.test:test_main (runs pytest with project config)
- dev-docs -> _dev.docs:docs_main (builds docs; see caution below)
These scripts are available after the package is installed (editable or wheel). For editable installs with uv, uv run dev-test works; with pip, ensure the venv’s bin is on PATH.

4) Documentation build (caution and safe local alternative)
- The helper at src/_dev/docs.py is designed for CI/publishing and manipulates a gh-pages branch (orphan branch creation, push). Do NOT run this casually on a working repository unless you intend to publish to GitHub Pages and have proper remotes configured.
- For safe local builds, invoke Sphinx directly without touching branches:
  - Using module form (portable):
    - uv run python -m sphinx.cmd.build -b html doc_src docs/main
  - Or with sphinx-build if on PATH:
    - uv run sphinx-build -b html doc_src docs/main
- The repository’s published docs live under docs/main in this tree.

5) Codebase notes: Option/Result and comparisons
- The core types live in src/option/option_.py (Option) and src/option/result.py (Result). types_.py defines helper protocols and type variables.
- Both Option and Result provide rich functional-style helpers (map, flatmap, unwrap, expect, map_or_else, etc.) and interoperate (e.g., Result.ok/err convert to Option). Docstrings contain doctest examples; keep these up to date when changing behavior.
- Ordering and equality: Result implements ordering such that Ok values sort before Err values, and comparable values are compared when the variant matches. Be mindful when changing semantics to adjust tests accordingly.

6) CI and coverage
- Pytest writes coverage.xml by default. GitHub workflows exist under .github/workflows/ for packaging and docs; the project uses pyproject-driven test config and is CI-friendly.

7) Building and publishing the package (advanced)
- Build with uv:
  - uv build
- If you need wheels/sdist via standard tools, ensure uv_build is available. Publishing to PyPI is out of scope here, but uv publish is supported if configured.

Troubleshooting tips specific to this repo
- If tests are skipped or doctests not collected, confirm you are running Python 3.12–3.13 and executing pytest from the project root so testpaths are honored.
- If Sphinx builds fail due to theme or smv errors, ensure docs deps are installed (use uv sync -g dev). Prefer the safe local Sphinx invocation shown above rather than _dev.docs.
- If dev scripts are not found, ensure the environment has the package installed and the environment’s bin directory is on PATH, or use uv run <script>.

Status of demo verification for this guideline
- A minimal test file like tests/test_demo_temp.py was created and run successfully during guideline authoring, then removed to keep the tree clean as requested.
